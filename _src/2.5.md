---
title: Ruby 2.5 changes
prev: 2.6
---

# Ruby 2.5

<!--
* **Details:**
* **Reason:**
* **Discussion:** [Feature #](https://bugs.ruby-lang.org/issues/)
* **Documentation:** []()
* **Code:**
* **Follow-up:**
 -->

## Language

### Top-level constant look-up is removed.

* **Details:** `Foo::Bar` doesn't fallback to `::Bar` anymore, when `Foo::Bar` is not found
* **Reason:** The behavior was considered bringing more problems and bugs than doing good for a long time, and always issued a warning.
* **Discussion:** [Feature #11547](https://bugs.ruby-lang.org/issues/11547)
* **Code:**
  ```ruby
  Hash::String
  # Ruby 2.4:
  #   (irb):1: warning: toplevel constant String referenced by Hash::String
  #    => String
  # Ruby 2.5:
  #   NameError (uninitialized constant Hash::String)
  ```

### `rescue`/`else`/`ensure` are allowed inside blocks

* **Reason:** for consistency with other `something` / `end` constructs (class and method bodies), which allowed `rescue` without wrapping in additional `begin`/`end`
* **Discussion:** [Feature #12906](https://bugs.ruby-lang.org/issues/12906)
* **Code:**
  ```ruby
  (0..5).map do |val|
    puts 100 / val
  rescue ZeroDivisionError
    puts '<undividable>'
  end
  # prints:
  #  <undividable>
  #  100
  #  50
  #  33
  #  25
  #  20
  ```
* **Notice:** The syntax is not available for `{}` blocks, even multiline ones.

### Refinements work in string interpolations

* **Reason:** Step in a consistent effort to make refinements more useful and consistent, working everywhere regular methods work
* **Discussion:** [Feature #13812](https://bugs.ruby-lang.org/issues/13812) (Japanese)
* **Code:**
  ```ruby
  module Ref
    refine Time do
      def to_s
        "#{hour}:#{min} at #{month}/#{day}/#{year}"
      end
    end
  end

  using Ref

  puts "Now is #{Time.now}"
  # Ruby 2.4: "Now is 2019-05-27 17:49:27 +0300" -- default to_s
  # Ruby 2.5: "Now is 17:51 at 5/27/2019" -- refined to_s
  ```
* **Follow-up:** Ruby 2.6 added [more features](https://rubyreferences.github.io/rubychanges/2.6.html#refinements-improved-visibility) making refinements available in various contexts.

## Core

### `Kernel`

_Notice that methods defined in `Kernel` are typically available on any object, that's why these changes are important._

#### `#yield_self`

* **Reason:** Chaining singular value processing the same way `Enumerable` allows chaining of sequence processing methods.
* **Discussion:** [Feature #6721](https://bugs.ruby-lang.org/issues/6721)
* **Code:**
  ```ruby
  [BASE_URL, path].join('/')
      .yield_self { |url| open(url).read }
      .yield_self { |body| JSON.parse(body, symbolyze_names: true) }
      .dig(:data, :items)
      .yield_self { |items| File.write('response.yml', items.to_yaml) }
  ```
* **Follow-up:** Ruby 2.6 [renamed (aliased)](https://rubyreferences.github.io/rubychanges/2.6.html#then-as-an-alias-for-yield_self) unfortunate method name to `#then`

#### `#pp`

* **Details:** `pp` standard library is now automatically required on the first call to `Kernel#pp`
* **Discussion:** [Feature #14123](https://bugs.ruby-lang.org/issues/14123)

#### `#warn`: `uplevel:` keyword argument

* **Details:** When `uplevel: N` provided to `Kernel#warn`, then warning message includes file and line of the call, `N` steps up in the callstack.
* **Reason:** It is sometimes hard to understand what exact code caused the warning, this feature helps to show the offensive calling code.
* **Discussion:** [Feature #12882](https://bugs.ruby-lang.org/issues/12882)
* **Documentation:** [Kernel#warn](https://ruby-doc.org/core-2.6/Kernel.html#method-i-warn) (it became somewhat documented at Ruby 2.6, but the feature itself is available since 2.5)
* **Code:**
  ```ruby
  def that_bad_function
    warn('do not call me')
    warn('I am talking to YOU', uplevel: 1)
    warn('and tell all your clients!', uplevel: 2)
  end

  def try_using_it
    that_bad_function # line 8
  end

  try_using_it # line 11

  # Prints:
  #  do not call me
  #  test.rb:8: warning: I am talking to YOU
  #  test.rb:11: warning: and tell all your clients!
  ```

### `Module`: methods for defining methods and accessors became public

* **Reason:** The methods affected are frequently used in metaprogramming, which prior to 2.5 required reopening classes/modules or using `send`
* **Discussion:** [Feature #14132](https://bugs.ruby-lang.org/issues/14132), [Feature #14133](https://bugs.ruby-lang.org/issues/14133)
* **Affected methods:** `#attr`, `#attr_accessor`, `#attr_reader` `#attr_writer`, `#define_method`, `#alias_method`, `#undef_method`, `#remove_method`.
* **Code:**
  ```ruby
  Array.define_method(:half_size) { size.to_f / 2 }
  # => :half_size
  [1, 2, 3].half_size
  # => 1.5
  ```

### `Method#===`

* **Reason:** `Method` object can be used in a lot of contexts where the `Proc` can be used, and this one context (case equality) was lacking.
* **Discussion:** [Feature #14142](https://bugs.ruby-lang.org/issues/14142)
* **Documentation:** [Method#===](https://ruby-doc.org/core-2.5.0/Method.html#method-i-3D-3D-3D)
* **Code:**
  ```ruby
  require 'prime'
  case 137
  when Prime.method(:prime?)
    puts 'prime'
  else
    puts 'not!'
  end
  # prints 'prime' in Ruby 2.5+, 'not' in Ruby 2.4
  ```

* Integer#pow accepts modulo argument for calculating modular
  exponentiation.  [Feature #12508] [Feature #11003]
* Integer#allbits?, Integer#anybits?, Integer#nobits? [Feature #12753]
* Integer.sqrt  [Feature #13219]

### `String`

#### `#delete_prefix`, `#delete_prefix!`, `#delete_suffix`, `#delete_suffix!`

* **Discussion:** [Feature #12694](https://bugs.ruby-lang.org/issues/12694), [Feature #13665](https://bugs.ruby-lang.org/issues/13665)
* **Documentation:** [String#delete_prefix](https://ruby-doc.org/core-2.5.0/String.html#method-i-delete_prefix), [String#delete_suffix](https://ruby-doc.org/core-2.5.0/String.html#method-i-delete_suffix)
* **Code:**
  ```ruby
  'foo'.delete_prefix('fo') # => 'o'
  'bar'.delete_suffix('r') # => 'ba'

  # Notice that bang-meethods return nil if they've deleted nothing:
  'foo'.delete_prefix!('ba') # => nil
  # This allows to use the methods in ifs:
  descr = RUBY_DESCRIPTION.dup # => "ruby 2.5.1p57 (2018-03-29 revision 63029) [x86_64-linux]"
  if descr.delete_prefix!('ruby ')
    puts "We are running on MRI #{descr}" # => "We are running on MRI 2.5.1p57 ...."
  end
  ```

#### `#each_grapheme_cluster` and `#grapheme_clusters`

* **Reason:** In modern Unicode, lot of on-screen characters (graphemes) represented, in fact, by several chars, which are logically combined into "grapheme cluster"; now Ruby has a proper way to work with those concepts.
* **Discussion:** [Feature #13780](https://bugs.ruby-lang.org/issues/13780)
* **Documentation:** [String#each_grapheme_cluster](https://ruby-doc.org/core-2.5.0/String.html#method-i-each_grapheme_cluster), [String#grapheme_clusters](https://ruby-doc.org/core-2.5.0/String.html#method-i-grapheme_clusters)
* **Code:**
  ```ruby
  "ðŸ³ï¸â€ðŸŒˆ".length
  # => 4
  "ðŸ³ï¸â€ðŸŒˆ".chars
  # => ["ðŸ³", "ï¸", "â€", "ðŸŒˆ"]
  "ðŸ³ï¸â€ðŸŒˆ".grapheme_clusters
  # => ["ðŸ³ï¸â€ðŸŒˆ"]
  "ðŸ³ï¸â€ðŸŒˆ".each_grapheme_cluster.map { |s| CGI.escape(s) }
  # => ["%F0%9F%8F%B3%EF%B8%8F%E2%80%8D%F0%9F%8C%88"]
  ```

#### `#undump`

* **Details:** The inverse of [String#dump](https://ruby-doc.org/core-2.5.0/String.html#method-i-dump) which escapes all non-printable and special characters.
* **Discussion:** [Feature #12275](https://bugs.ruby-lang.org/issues/12275)
* **Documentation:** [String#undump](https://ruby-doc.org/core-2.5.0/String.html#method-i-undump)
* **Code:**
  ```ruby
  p <<~STR
    This is "fine".
    Or is it?
  STR
  # Prints "This is \"fine\".\nOr is it?\n"
  # ^ Now, this is dumped string, including quotes around.
  # How to get back to "nice" string?
  puts '"This is \"fine\".\nOr is it?\n"'.undump
  # Prints
  #  This is "fine".
  #  Or is it?
  ```

#### `#casecmp` and `#casecmp?` return `nil` for non-string arguments

* **Details:** Previously, those method raised `TypeError` on arguments that can't be coerced to `String`, now they just return `nil`
* **Reason:** The behavior made consistent with `==` and `<=>`, as the methods are case-agnostic versions of those operators: when you compare incomparable things, you just get no result at all.
* **Discussion:** [Feature #13312](https://bugs.ruby-lang.org/issues/13312)
* **Documentation:** [String#casecmp](https://ruby-doc.org/core-2.5.0/String.html#method-i-casecmp), [String#casecmp?](https://ruby-doc.org/core-2.5.0/String.html#method-i-casecmp-3F)
* **Code:**
  ```ruby
  "foo".casecmp?(:foo)
  # Ruby 2.4: TypeError: no implicit conversion of Symbol into String
  # Ruby 2.5: nil
  ```

#### `#start_with?` accepts a regexp

* **Details:** `string.start_with?(/foo/)` is an equivalent of `string.match?(/\Afoo/)`
* **Discussion:** [Feature #13712](https://bugs.ruby-lang.org/issues/13712)
* **Documentation:** [String#start_with?](https://ruby-doc.org/core-2.6/String.html#method-i-start_with-3F) (introduced in 2.5, but documented in 2.6)

#### `String#-@` optimized for memory preserving

* **Details:** `String#-` (freezing the string) is optimize to deduplicate frozen object
* **Discussion:** [Feature #13077](https://bugs.ruby-lang.org/issues/13077), [Feature #13295](https://bugs.ruby-lang.org/issues/13295)
* **Documentation:** [String#-@](https://ruby-doc.org/core-2.5.0/String.html#method-i-2D-40)
* **Code:**
  ```ruby
  str = String.new('not frozen')
  10.times.map { -str }.map(&:object_id)
  # Ruby 2.4: 10 different ids => 10 different frozen string objects
  # Ruby 2.5: 10 same ids => always the same frozen object

  5.times.map { -'test' }.map(&:object_id)
  # Ruby 2.4: 5 different ids => 5 different frozen string objects
  # Ruby 2.5: 5 same ids => always the same frozen object
  ```

### `Regexp`: absence operator

* **Details:** Underlying [Onigmo](https://github.com/k-takata/Onigmo) Regexp library was updated, which brought new operator: `(?~foo)` means "match any string that **do not** ends with `foo`"
* **Documentation:** â€”
* **Code:**
  ```ruby
  # Classic example of usefulness: matching C comments:
  code = <<~C
    /* This is a comment.
    It ends here: */
    // And not here: */
  C
  code.scan(%r{/\*.+\*/}m)
  # => ["/* This is a comment.\nIt ends here: */\n// And not here: */"]
  code.scan(%r{/\*(?~\*/)\*/})
  # => ["/* This is a comment.\nIt ends here: */"]
  ```

### `Struct` with keyword arguments

* **Details:** `Struct` can be created with `keyword_init: true`, and then its instance will require keyword arguments to initialize
* **Discussion:** [Feature #11925](https://bugs.ruby-lang.org/issues/11925)
* **Documentation:** [Struct.new](https://ruby-doc.org/core-2.5.0/Struct.html#method-c-new)
* **Code:**
  ```ruby
  Person = Struct.new(:first, :last, :age)
  ModernPerson = Struct.new(:first, :last, :age, keyword_init: true)

  Person.new('Bob', 'Jones', 40)
  # => #<struct Person first="Bob", last="Jones", age=40>
  ModernPerson.new(first: 'Meredith', last: 'Williams', age: 28)
  # => #<struct ModernPerson first="Meredith", last="Williams", age=28>
  ModernPerson.new('Meredith', 'Williams', 28)
  # ArgumentError (wrong number of arguments (given 3, expected 0))
  ```

### `Time.at`: units

* **Details:** `Time.at` second argument was meant to be microseconds, but in 2.5+ it can be micro-, milli- or nano-seconds, specified by third argument: `:millisecond`, `:usec` or `:microsecond` (default), `:nanosecond`
* **Reason:** It was noted that when you have nanoseconds value (available as `Time#nsec`) and want to pass it to `.at`, it is inconvenient to divide it by `1000`.
* **Discussion:** [Feature #13919](https://bugs.ruby-lang.org/issues/13919)
* **Documentation:** [Time.at](https://ruby-doc.org/core-2.5.0/Time.html#method-c-at)
* **Code:**
  ```ruby
  nanoseconds = 123456789
  # The only way previously to create time with nsec value
  Time.at(946684800, nanoseconds / 1000.0).nsec # => 123456789
  # New way
  Time.at(946684800, nanoseconds, :nanosecond).nsec # => 123456789
  # Also convenient for some contexts: .123 seconds
  Time.at(946684800, 123, :millisecond).usec
  # => 123000
  ```

### Collections

#### `Enumerable#any?`, `#all?`, `#none?` and `#one?` accept patterns

* **Details:** Any argument that responds to `#===` may now be passed (akin to `grep`)
* **Discussion:** [Feature #11286](https://bugs.ruby-lang.org/issues/11286)
* **Documentation:** [Enumerable#all?](https://ruby-doc.org/core-2.5.0/Enumerable.html#method-i-all-3F), [Enumerable#any?](https://ruby-doc.org/core-2.5.0/Enumerable.html#method-i-any-3F), [Enumerable#none?](https://ruby-doc.org/core-2.5.0/Enumerable.html#method-i-none-3F), [Enumerable#one?](https://ruby-doc.org/core-2.5.0/Enumerable.html#method-i-one-3F)
* **Code:**
  ```ruby
  [1, 2, nil].all?(Numeric) # => false
  ['America', 'Europe', 'Africa', 'Asia'].any?(/^E/) # => true
  (1..20).one?(20..30) # => true
  require 'set'
  [:foo, :bar, :baz].none?(Set[:foo, :test]) # => false
  ```

#### `Array#append` and `#prepend`

* **Details:** Just aliases for `#push` and `#unshift`
* **Reason:** The old methods are symmetric with `#pop` and `#shift`, respectively, but asymmetric with each other and (especially `#unshift`) hard to guess and remember
* **Discussion:** [Feature #12746](https://bugs.ruby-lang.org/issues/12746)
* **Documentation:** [Array#append](https://ruby-doc.org/core-2.5.0/Array.html#method-i-append), [Array#prepend](https://ruby-doc.org/core-2.5.0/Array.html#method-i-prepend)
* **Code:**
  ```ruby
  ary = [1, 2, 3]
  ary.append(4)
  # => [1, 2, 3, 4]
  ary.prepend(0)
  # => [0, 1, 2, 3, 4]
  ary
  # => [0, 1, 2, 3, 4]
  ```

#### `Hash#transform_keys` and `#transform_keys!`

* **Discussion:** [Feature #13583](https://bugs.ruby-lang.org/issues/13583)
* **Documentation:** [Hash#transform_keys](https://ruby-doc.org/core-2.5.0/Hash.html#method-i-transform_keys), [Hash#transform_keys!](https://ruby-doc.org/core-2.5.0/Hash.html#method-i-transform_keys-21)
* **Code:**
  ```ruby
  {a: 1, b: 2}.transform_keys { |sym| sym.to_s.capitalize }
  # => {"A"=>1, "B"=>2}
  {a: 1, b: 2}.transform_keys(&:to_s)
  # => {"a"=>1, "b"=>2}
  {a: 1, b: 2}.transform_keys(&:length) # non-unique - the last value is taken
  # => {1=>2}
  {a: 1, b: 2}.transform_keys           # without block - returns enumerator
  # => #<Enumerator: {:a=>1, :b=>2}:transform_keys>
  # The latter can be useful when modified by .with_index
  {a: 1, b: 2}.transform_keys.with_index(1) { |k, i| "#{i}: #{k}" }
  # => {"1: a"=>1, "2: b"=>2}
  ```
* **Follow-up:** Since **Ruby 2.5.1**, the behavior of `transform_keys!` (bang version) is changed: Ruby 2.5.0 changes hash as it goes (the same behavior as old ActiveSupport's method with the same name), while Ruby 2.5.1 first calculates new hash and then replaces the old one:
  ```ruby
  # Ruby 2.5.0, Ruby 2.4 with ActiveSupport
  h = {1 => :hello, 2 => 'world'}
  h.transform_keys!(&:succ) # first, 2 => :hello replaces 2 => 'world', then the same key is processed again
  # => {3=>:hello}

  # Ruby 2.5.1
  h = {1 => :hello, 2 => 'world'}
  h.transform_keys!(&:succ)
  # => {2=>:hello, 3=>"world"}
  ```
  Discussion: [Bug #14380](https://bugs.ruby-lang.org/issues/14380)

#### `Hash#slice`

* **Discussion:** [Feature #13563](https://bugs.ruby-lang.org/issues/13563)
* **Documentation:** [Hash#slice](https://ruby-doc.org/core-2.5.0/Hash.html#method-i-slice)
* **Code:**
  ```ruby
  h = { a: 100, b: 200, c: 300 }
  h.slice(:a)           #=> {:a=>100}
  h.slice(:b, :c, :d)   #=> {:b=>200, :c=>300}
  ```
* **Follow-up:** Funny enough, what started at [#8499](https://bugs.ruby-lang.org/issues/8499) as discussing of importing `#slice`/`#slice!`/`#except` and `#except!` from ActiveSupport, ended up in a several tickets: `#slice` (current one, accepted for 2.5), `#slice!` ([#15863](https://bugs.ruby-lang.org/issues/15863), rejected by Matz, "no real-life use-case"), and `#except` ([#15822](https://bugs.ruby-lang.org/issues/15822), recent ticket, not merged as of May 2019)

### Exceptions

#### Backtrace and error message in reverse order

* **Details:** New behavior is activated if `STDERR` is TTY
* **Discussion:** [Feature #8661](https://bugs.ruby-lang.org/issues/8661)
* **Code:**
  ```
  $ cat test.rb
  {a: 1}.fetch(:b)
  $ ruby test.rb
  # Ruby 2.4:
  test.rb:1:in `fetch': key not found: :b (KeyError)
    from test.rb:1:in `<main>'

  # Ruby 2.5:
  Traceback (most recent call last):
    1: from test.rb:1:in `<main>'
  test.rb:1:in `fetch': key not found: :b (KeyError)
  ```
* **Follow-up:** Feature is tagged "experimental" in Ruby 2.5, but as of Ruby 2.7-preview1 it is still active, so should be considered stable.

#### `Exception#full_message`

* **Details:** `Exception#full_message` provides the same string Ruby will print if exception is not caught.
* **Discussion:** [Feature #14141](https://bugs.ruby-lang.org/issues/14141)
* **Documentation:** [Exception#full_message](https://ruby-doc.org/core-2.5.0/Exception.html#method-i-full_message)
* **Code:**
  ```ruby
  # test.rb
  begin
    {a: 1}.fetch(:b)
  rescue => e
    puts e.full_message
  end
  # `ruby test.rb` prints:
  #   Traceback (most recent call last):
  #     1: from test.rb:2:in `<main>'
  #   test.rb:2:in `fetch': key not found: :b (KeyError)
  #
  # `ruby test.rb 2>err.log` prints:
  #   test.rb:2:in `fetch': key not found: :b (KeyError)
  #     from test.rb:2:in `<main>
  ```
* **Notice:** The format is different depending of whether **`STDERR`** is TTY or not (even if you printing the returned string to `STDOUT` or just storing it in the variable)
* **Follow-up:** Ruby 2.6 added [options for `#full_message`](https://rubyreferences.github.io/rubychanges/2.6.html#exceptionfull_message-options) for enforcing desired format indepenent of whether `STDERR` is TTY

#### `KeyError#receiver` and `#key`

* **Discussion:** [Feature #12063](https://bugs.ruby-lang.org/issues/12063)
* **Documentation:** [KeyError](https://ruby-doc.org/core-2.5.0/KeyError.html)
* **Code:**
  ```ruby
  begin
    {a: 1}.fetch(:b)
  rescue => e
    p e.receiver # => {:a=>1}
    p e.key      # => :b
  end
  ```
* **Follow-up:** Since Ruby 2.6, `receiver:` and `key:` [could also be passed](https://rubyreferences.github.io/rubychanges/2.6.html#new-arguments-receiver-and-key) when creating `KeyError` in your code (as of Ruby 2.5, only C code could've create "proper" `KeyError`)

#### New class: `FrozenError`

* **Discussion:** [Feature #13224](https://bugs.ruby-lang.org/issues/13224)
* **Documentation:** [FrozenError](https://ruby-doc.org/core-2.5.0/FrozenError.html)
* **Code:**
  ```ruby
  a = [1, 2, 3].freeze
  a << 4
  # Ruby 2.4: RuntimeError: can't modify frozen Array
  # Ruby 2.5: FrozenError (can't modify frozen Array)
  ```

#### Don't hide coercion errors

* **Details:** Some `Numeric` and `Range` methods have previously caught errors when the provided values were incompatible, and thrown their own; it was hard to debug, so now original error is thrown.
* **Discussion:** [Feature #7688](https://bugs.ruby-lang.org/issues/7688)
* **Affected methods:** `Numeric#step`, `#<`, `#>`, `#>=`, `#<=` (when `other.coerce` method fails), `Range#initialize` (when `<=>` method of range's ends fail)
* **Code:**
  ```ruby
  class MyString
    def initialize(str)
      @str = str
    end

    def <=>(other)
      # This will fail: we forgot to define attr_reader :str
      str <=> other.str
    end

    include Comparable
  end

  'bar'..MyString.new('foo')
  # Ruby 2.4: test.rb:13:in `<main>': bad value for range (ArgumentError)
  # Ruby 2.5: test.rb:7:in `<=>': undefined local variable or method `str' for #<MyString:0x0000556d024e7b08 @str="bar"> (NameError)
  ```

### Filesystem and IO

#### `IO#pread` and `#pwrite`

* **Details:** Two atomic methods utilize corresponding system calls to read or write file at specified offset, instead of `#seek` + `#read`/`#write`
* **Reason:**
* **Discussion:** [Feature #4532](https://bugs.ruby-lang.org/issues/4532)
* **Documentation:** [IO#pread](https://ruby-doc.org/core-2.5.0/IO.html#method-i-pread), [IO#pwrite](https://ruby-doc.org/core-2.5.0/IO.html#method-i-pwrite)
* **Code:**
  ```ruby
  File.write('tmp.txt', 'test me please')
  f = File.open('tmp.txt')
  f.pread(2, 5) # => "me"
  f.pos         # => 0, unchanged
  ```

#### `IO#write` accepts multiple arguments

* **Discussion:** [Feature #9323](https://bugs.ruby-lang.org/issues/9323)
* **Documentation:** [IO#write](https://ruby-doc.org/core-2.5.0/IO.html#method-i-write)
* **Code:**
  ```ruby
  $stdout.write('test ', 'me ', 'please')
  # Prints: test me please
  ```
* **Notice:** Standard library classes that inherit or mimic IO interface also were updated: [StringIO#write](https://ruby-doc.org/stdlib-2.5.0/libdoc/stringio/rdoc/StringIO.html#method-i-write), [Zlib::GZipWriter#write](https://ruby-doc.org/stdlib-2.5.0/libdoc/zlib/rdoc/Zlib/GzipWriter.html#method-i-write)

* File.open accepts +:newline+ option to imply text mode. [Bug #13350]
* File#path raises an IOError for files opened with File::Constants::TMPFILE option. [Feature #13568]

#### `File.lutime`

* **Details:** Same as `utime`, but for symlinks sets modification time of link itself, not the referred object
* **Discussion:** [Feature #4052](https://bugs.ruby-lang.org/issues/4052)
* **Documentation:** [File.lutime](https://ruby-doc.org/core-2.5.0/File.html#method-c-lutime)

####  `Dir.children` and `.each_child`

* **Discussion:** [Feature #11302](https://bugs.ruby-lang.org/issues/11302)
* **Documentation:** [Dir.children](https://ruby-doc.org/core-2.5.0/Dir.html#method-c-children), [Dir.each_child](https://ruby-doc.org/core-2.5.0/Dir.html#method-c-each_child)
* **Code:**
  ```ruby
  Dir.children('.')
  # => ["_layouts", ".gitignore", "README.md", "_data", "_src", "_site", "Contributing.md", "_config.yml", "2.6.md", "js", "404.html", ".git", "images", "Gemfile", "css", "Gemfile.lock"]
  ```
* **Follow-up:** Ruby 2.6 added [instance methods](https://rubyreferences.github.io/rubychanges/2.6.html#direach_child-and-dirchildren) with same behavior

#### `Dir.glob`: `base:` argument

* **Discussion:** [Feature #13056](https://bugs.ruby-lang.org/issues/13056)
* **Documentation:** [Dir.glob](https://ruby-doc.org/core-2.5.0/Dir.html#method-c-glob)
* **Code:**
  ```ruby
  Dir.glob('*')
  # => ["_layouts", "README.md", "err.log", "_data", "_src", "_site", "Contributing.md", "_config.yml", "2.6.md", "js", "404.html", "images", "Gemfile", "css", "Gemfile.lock"]
  Dir.glob('*', base: '_src')
  # => ["2.5.md", "script", "tmp", "2.6.md"]
  ```

### `Process.last_status` as an alias of `$?`

* **Discussion:** [Feature #14043](https://bugs.ruby-lang.org/issues/14043)
* **Documentation:** [Process.last_status](https://ruby-doc.org/core-2.5.0/Process.html#method-c-last_status)

### `Thread#fetch`

* **Details:** Much akin to `Hash#fetch`, allows to fetch thread-local variable or provide default value
* **Discussion:** [Feature #13009](https://bugs.ruby-lang.org/issues/13009)
* **Documentation:** [Thread#fetch](https://ruby-doc.org/core-2.6/Thread.html#method-i-fetch) (feature is present since Ruby 2.5, but explanations added later)
* **Code:**
  ```ruby
  threads = [Thread.new { Thread.current[:name] = "first" }, Thread.new {}]
  threads.each(&:join)
  threads.map { |t| t.fetch(:name, '<not set>') }
  # => ["first", "<not set>"]
  threads.last.fetch(:name)
  # KeyError (key not found: :name)
  threads.last.fetch(:name) { |key| "#{key} not set at #{Time.now}" }
  # => "name not set at 2019-05-30 16:50:44 +0300"
  ```

### `RubyVM::InstructionSequence` new methods

* **Documentation:** [RubyVM::InstructionSequence#each_child](https://ruby-doc.org/core-2.5.0/RubyVM/InstructionSequence.html#method-i-each_child), [RubyVM::InstructionSequence#trace_points](https://ruby-doc.org/core-2.5.0/RubyVM/InstructionSequence.html#method-i-trace_points)

### Misc

* `Random.raw_seed` renamed to [Random.urandom](https://ruby-doc.org/core-2.5.0/Random.html#method-c-urandom).  It is now applicable to non-seeding purposes due to [Bug #9569].
* `Data` is deprecated. It was a base class for C extensions, and it's not necessary to expose in Ruby level. [Feature #3072](https://bugs.ruby-lang.org/issues/3072)

## Standard library

### Data types

* `BigDecimal` is now behaves more consistent with core numeric classes: `BigDecimal.new` is deprecated in favor of `Kernel::BigDecimal()`, and `#clone` and `#dup` methods return the same instance.
* `Matrix`:
  * [Matrix.combine](https://ruby-doc.org/stdlib-2.5.0/libdoc/matrix/rdoc/Matrix.html#method-c-combine) and [Matrix#combine](https://ruby-doc.org/stdlib-2.5.0/libdoc/matrix/rdoc/Matrix.html#method-i-combine). Discussion: [Feature #10903](https://bugs.ruby-lang.org/issues/10903)
  * [Matrix#hadamard_product](https://ruby-doc.org/stdlib-2.5.0/libdoc/matrix/rdoc/Matrix.html#method-i-hadamard_product) (aliased as [Matrix#entrywise_product](https://ruby-doc.org/stdlib-2.5.0/libdoc/matrix/rdoc/Matrix.html#method-i-entrywise_product))

#### `Set`

* [Set#to_s](https://ruby-doc.org/stdlib-2.5.0/libdoc/set/rdoc/Set.html#method-i-to_s) is an alias to `#inspect` [Feature #13676](https://bugs.ruby-lang.org/issues/13676)
  ```ruby
  puts Set[:foo, :bar]
  # Ruby 2.4: #<Set:0x00005614c9069e68>
  # Ruby 2.5: #<Set: {:foo, :bar}>
  ```
* [Set#===](https://ruby-doc.org/stdlib-2.5.0/libdoc/set/rdoc/Set.html#method-i-3D-3D-3D) as alias to `#include?` [Feature #13801](https://bugs.ruby-lang.org/issues/13801) This allows to use sets in `case` and `grep`:
  ```ruby
  case RUBY_VERSION
  when Set['2.5.0', '2.5.1', '2.5.2', '2.5.3']
    # ...
  end

  [:open, :work, :pause, :close, :open, :break].grep(Set[:open, :close])
  # => [:open, :close, :open]
  ```
* [Set#reset](https://ruby-doc.org/stdlib-2.5.0/libdoc/set/rdoc/Set.html#method-i-reset) [Feature #6589](https://bugs.ruby-lang.org/issues/6589) allows to ensure set's internal state consistency after modifying a mutable element of the set:
  ```ruby
  processes = Set[[:open], [:work]]
  processes.first << :close
  processes
  # => #<Set: {[:open, :close], [:work]}>
  processes.include?([:open, :close]) # => false
  processes.reset
  processes.include?([:open, :close]) # => true
  ```

### Text processing

* `StringScanner`: methods [#size](https://ruby-doc.org/stdlib-2.5.0/libdoc/strscan/rdoc/StringScanner.html#method-i-size), [#captures](https://ruby-doc.org/stdlib-2.5.0/libdoc/strscan/rdoc/StringScanner.html#method-i-captures), [#values_at](https://ruby-doc.org/stdlib-2.5.0/libdoc/strscan/rdoc/StringScanner.html#method-i-values_at) to introspect latest match, consistent with those of [MatchData](https://ruby-doc.org/core-2.5.0/MatchData.html). Discussion: [Feature #836](https://bugs.ruby-lang.org/issues/836)
  ```ruby
  scanner = StringScanner.new('y = x^2')
  scanner.scan(/(\w+)\s*=\s*/)
  # => "y = "
  scanner.size            # number of captures, including entire matched string
  # => 2
  scanner.values_at(0, 1) # 0 is "entire matched sequence", 1 is "first capture"
  # => ["y = ", "y"]
  scanner.captures        # only captures
  # => ["y"]
  ```
* [ERB#result_with_hash](https://ruby-doc.org/stdlib-2.5.0/libdoc/erb/rdoc/ERB.html#method-i-result_with_hash) added to allow passing local variables via hash instead of `Binding` object. Discussion: [Feature #8631](https://bugs.ruby-lang.org/issues/8631)
  ```ruby
  require 'erb'
  ERB.new('x = <%= x %>').result_with_hash(x: 11)
  # => "x = 11"
  ```

### Network and Web

* open-uri: URI.open method defined as an alias to open-uri's Kernel.open. open-uri's Kernel.open will be deprecated in future.

* Net::HTTP
  * Net::HTTP.new supports no_proxy parameter [Feature #11195]
  * Net::HTTP#min_version and Net::HTTP#max_version [Feature #9450]
  * Add more HTTP status classes
  * Net::HTTP::STATUS_CODES is added as HTTP Status Code Repository [Misc #12935]
  * Net::HTTP#proxy_user and Net::HTTP#proxy_pass reflect http_proxy environment variable if the  system's environment variable is multiuser safe. [Bug #12921]
* WEBrick
  * Add Server Name Indication (SNI) support [Feature #13729]
  * support Proc objects as body responses [Feature #855]
  * avoid unintended behavior from Kernel#open [Misc #14216]

### Ruby development and introspection

* Coverage: support branch coverage and method coverage measurement. [Feature #13901]
* IRB: `binding.irb` automatically requires irb and runs [Bug #13099] [experimental]
* `RbConfig::LIMITS` is added to provide the limits of C types:
  ```ruby
  require 'rbconfig/sizeof'
  RbConfig::LIMITS['FIXNUM_MAX']
  # => 4611686018427387903
  ```
* [Ripper::Filter#state](https://ruby-doc.org/stdlib-2.5.0/libdoc/ripper/rdoc/Ripper/Filter.html#method-i-state) to tell the state of scanner. [Feature #13686](https://bugs.ruby-lang.org/issues/13686)

### Misc

* [Pathname#glob](https://ruby-doc.org/stdlib-2.5.0/libdoc/pathname/rdoc/Pathname.html#method-c-glob) Discussion: [Feature #7360](https://bugs.ruby-lang.org/issues/7360):
  ```ruby
  require 'pathname'
  Pathname.new('.').glob('*.md')
  # => [#<Pathname:2.5.md>, #<Pathname:README.md>, #<Pathname:Contributing.md>, #<Pathname:2.6.md>]
  ```
* [SecureRandom.alphanumeric](https://ruby-doc.org/stdlib-2.5.0/libdoc/securerandom/rdoc/Random/Formatter.html#method-i-alphanumeric)
* `mathn.rb` removed from stdlib. [Feature #10169](https://bugs.ruby-lang.org/issues/10169). It [was](https://github.com/ruby/ruby/blob/ruby_2_4/lib/mathn.rb#L7) a library that patched some of core classes to make Ruby's math more "natural" (by providing `Rational` and `Complex` operations where necessary), but it was decided that side-effects of it implicit inclusion too sudden, and explicit usage of Rational and Complex became much more natural in latest Ruby versions.

### Large updated libraries

* **Psych** 3.0.2: _No changelog available._
* **RDoc** 6.0.1: _[Changelog](https://github.com/ruby/rdoc/blob/master/History.rdoc) is outdated._
* **Rubygems** 2.7.3: [Changelog](https://github.com/rubygems/rubygems/blob/9bde8cd05e9e2f4a73d6783f09896dd551b58ebe/History.txt)
* **IPAddr** 1.2.1: [Changelog](https://github.com/ruby/ipaddr/blob/master/CHANGELOG.md#121)
* **OpenSSL** 2.1: [Changelog](https://github.com/ruby/ruby/blob/trunk/ext/openssl/History.md#version-210).

### Libraries promoted to default gems

> **[stdgems.org](https://stdgems.org/)** project has a nice explanations of default and bundled gems concepts, as well as a list of currently gemified libraries.

"For the rest of us" this means libraries development extracted into separate GitHub repositories, and they are just packaged with main Ruby before release. It means you can do issue/PR to any of them independently, without going through more tough development process of the core Ruby.

Libraries extracted in 2.5:

* [cmath](https://github.com/ruby/cmath)
* [csv](https://github.com/ruby/csv)
* [date](https://github.com/ruby/date)
* [dbm](https://github.com/ruby/dbm)
* [etc](https://github.com/ruby/etc)
* [fcntl](https://github.com/ruby/fcntl)
* [fiddle](https://github.com/ruby/fiddle)
* [fileutils](https://github.com/ruby/fileutils)
* [gdbm](https://github.com/ruby/gdbm)
* [ipaddr](https://github.com/ruby/ipaddr)
* [scanf](https://github.com/ruby/scanf)
* [sdbm](https://github.com/ruby/sdbm)
* [stringio](https://github.com/ruby/stringio)
* [strscan](https://github.com/ruby/strscan)
* [webrick](https://github.com/ruby/webrick)
* [zlib](https://github.com/ruby/zlib)

**Follow-up:** [14 more libraries](https://rubyreferences.github.io/rubychanges/2.6.html#libraries-promoted-to-default-gems) gemified in 2.6